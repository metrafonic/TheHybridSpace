<!DOCTYPE html>


<html>
<title>The Hybrid Space</title>

<head>
    <script src="/javascripts/highcharts.js"></script>
    <script src="/javascripts/urltools.js"></script>
    <script type="text/javascript" src="/javascripts/jquery.min.js"></script>

    <style>
        #container {
            min-width: 580px;
            height: 600px;
            max-width: 580px;
            margin: 0 auto
        }
        #containerslider1 {
            height: 200px;
            margin: 0 auto
        }
        #containerslider2 {
            height: 200px;
            margin: 0 auto
        }
    </style>
</head>

<body>
    <div id="container"></div>
    <div id="containerslider1"></div>
    <div id="containerslider2"></div>
    <text id="person"></text><br>
    <text id="team"></text><br>
    <text id="collection"></text><br>

    <script>

        function updateData() {
            $.when(
                $.getJSON('/api/person/' + getUrlParameter('id')),
                $.getJSON('/api/evaluations/' + getUrlParameter('id'))
            ).done(function(a, b) {
                try {
                    parseData(b[0]);
                } catch (err) {
                    console.log(err.message);
                }
                //console.log(a[0].data);
                $("#person").html("<b>Person: </b>" + a[0].data.person);
                $("#team").html("<b>Team: </b>" + a[0].data.team);
                $("#collection").html("<b>Group: </b>" + a[0].data.collection);


            });
        }

        function parseData(data) {
            datedata= {};
            slider1data={};
            slider2data={};
            i = 0;
            $.each(data.data, function(key, value) {
                if (!datedata.hasOwnProperty(value.date)){
                  datedata[value.date]=[];
                  slider1data[value.date]=[];
                  slider2data[value.date]=[];
                }
                datedata[value.date].push([value.x, value.y]);
                slider1data[value.date].push([value.time, value.slider1]);
                slider2data[value.date].push([value.time, value.slider2]);

                i++;
            });
            showScatter(datedata);
            showSlider(slider1data, 'slider1','containerslider1');
            showSlider(slider2data, 'slider2','containerslider2');
        }


        function showScatter(data) {
            var options = {

                plotOptions: {
                    scatter: {
                        animation: false,
                        lineWidth:2
                    }
                },
                chart: {
                    renderTo: 'container',
                    type: 'scatter',
                    backgroundColor: '#FFFFFF',
                    plotBackgroundImage: '/images/hybrid.jpg',

                },
                title: {
                    text: 'Data for person ' + getUrlParameter('id')
                },
                xAxis: {
                    gridLineWidth: 0,
                    tickInterval: 1,
                    lineColor: 'black',
                    zeroCrossing: false,
                    min: -250,
                    max: 250
                },
                yAxis: {
                    min: -250,
                    max: 250,
                    gridLineWidth: 0,
                    title: {
                        _text: null
                    }
                },
                series: []
            };
            i=0;
            $.each(data, function(key, value) {
                console.log(key);
                options.series[i] = {name: key};
                options.series[i].data = value;
                i++;
            });
            var chart = new Highcharts.Chart(options);
        }

        function showSlider(data, title, element) {
            var options = {

                plotOptions: {
                    line: {
                        animation: false,
                        lineWidth:2
                    }
                },
                chart: {
                    renderTo: element,
                    type: 'line',

                },
                title: {
                    text: title
                },

                series: []
            };
            i=0;
            $.each(data, function(key, value) {
                console.log(key);
                options.series[i] = {name: key};
                options.series[i].data = value;
                i++;
            });
            var chart = new Highcharts.Chart(options);
        }

        updateData();
        setInterval(updateData, 5000);
    </script>
</body>

</html>
